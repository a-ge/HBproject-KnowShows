<!doctype html>
<html lang="en">
<head>
    <!-- For Bootstrap -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- https://formden.com/form-builder/ -->
    <!-- Special version of Bootstrap that only affects content wrapped in .bootstrap-iso -->
    <link rel="stylesheet" href="https://formden.com/static/cdn/bootstrap-iso.css" />

    <!--Font Awesome (added because you use icons in your prepend/append)-->
    <link rel="stylesheet" href="https://formden.com/static/cdn/font-awesome/4.4.0/css/font-awesome.min.css" />

    <!-- Inline CSS based on choices in "Settings" tab -->
    <style>.bootstrap-iso .formden_header h2, .bootstrap-iso .formden_header p, .bootstrap-iso form{font-family: Arial, Helvetica, sans-serif; color: black}.bootstrap-iso form button, .bootstrap-iso form button:hover{color: white !important;} .asteriskField{color: red;}</style>

    <!-- For jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

    </head>

<body>
    <!-- Navigation bar to display on every page -->
    <nav class="navbar sticky-top navbar-light bg-light">

        <span class="navbar-title">KnowShows</span><br>

        <form class="form-inline" action="/search" method="POST">

            <label for="searchType">Select</label>
                <select class="form-control" name="searchType" id="searchType">
                <option value="Event">Event</option>
                <option value="Venue">Venue</option>
                <option value="Artist">Artist</option>
                </select>

            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="userSearchInput" id="userSearchInput" required>

            <label for="userCityInput">City</label>
                <input type="text" class="form-control" name="userCityInput" id="userCityInput" placeholder="">

            <label for="form-control">State</label>
                <select class="form-control" name="state" id="state">
                <option value=""></option>
                <option value="CA">CA</option>
                <option value="NY">NY</option>
                <option value="WA">WA</option>
                </select>

            <div>
                <button class="btn btn-sm btn-outline-secondary"id="loc-button">Find my location</button>
                <div id="output"></div>
            </div>

            <label class="control-label " for="startdate" id="startDateLabel">Start Date
                <input class="form-control" id="startdate" name="startdate" placeholder="MM/DD/YYYY" type="text" pattern="(0?[1-9]|[12][0-9]|3[01])/(0?[1-9]|1[012])/\d{4}"/>
                </label>
            <label class="control-label " for="enddate" id="endDateLabel">End Date
                <input class="form-control" id="enddate" name="enddate" placeholder="MM/DD/YYYY" type="text" pattern="(0?[1-9]|[12][0-9]|3[01])/(0?[1-9]|1[012])/\d{4}"/>
                </label>
            <button type="submit">Search</button>

        </form>

    </nav>

    <script>
        "use strict";

        var pos;
        var location;
        var city;
        // From Google Maps JavaScript API
        // https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
        $('#loc-button').click(function(e){
            e.preventDefault();

            if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position){
                pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            // https://developers.google.com/maps/documentation/geocoding/intro
            var GEOCODING = 'https://maps.googleapis.com/maps/api/geocode/json?latlng=' + position.coords.latitude + '%2C' + position.coords.longitude + '&language=en' + '&key=AIzaSyAkptiAE4ZWb1gHEZjFGXB3MwyoaUWOmo0';

            $.getJSON(GEOCODING).done(function(location) {
                location = {
                    cityInput: location.results[0].address_components[3].long_name,
                    stateInput: location.results[0].address_components[5].short_name

                }
                console.log(location)
                // console.log(city)
                // console.log(state)
                // $('#state').html(location.results[0].address_components[5].short_name);
                // $('#userCityInput').html(location.results[0].address_components[3].long_name);
            });
            $.get("/index", location, (results) =>

                
                console.log(location));

            // cityInput: location.results[0].address_components[3].long_name,
            //     stateInput: location.results[0].address_components[5].short_name
            // https://stackoverflow.com/questions/14908864/how-can-i-use-data-posted-from-ajax-in-flask
            // $.ajax({
            //     type : "POST",
            //     url : "{{url_for('index')}}",
            //     data: JSON.stringify(loc),
            //     contentType: 'application/json;charset=UTF-8',
            //     success: function(result) {
            //         console.log(result);
            //         }});
            //         console.log(pos);
            })}
            else {
                console.log("geolocation is not supported");
            }})


        // Dynamic form handling.
        const searchInput = $('#searchType')
        const startDate = $('#startDateLabel')
        const endDate = $('#endDateLabel')

        var inputValue = searchInput.val()

        // Handle change event on search input.
        searchInput.change((e) => {
            inputValue = e.target.value
            
            if (inputValue === 'Artist') {
                startDate.hide()
                endDate.hide()
            }
            else {
                startDate.show()
                endDate.show()
            }
        })
    </script>

    {% block content %}{% endblock %}

    <!-- For Google Maps API -->
    <!--Load the API from the specified URL
    * The async attribute allows the browser to render the page while the API loads
    * The key parameter will contain your own API key (which is not needed for this tutorial)
    * The callback parameter executes the initMap() function -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAkptiAE4ZWb1gHEZjFGXB3MwyoaUWOmo0"></script>

    <!-- For Bootstrap -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>

            <!-- May want to keep list of genres as an option -->
<!--    <div class="form-group">
            <label for="genre">Genre</label>
                <select class="form-control" id="genre" name="genre">
                <option value="None"></option>
                <option value="Rock">Rock</option>
                <option value="Pop">Pop</option>
                <option value="Folk">Folk</option>
                </select>
      </div> -->

      <!--     <div>
        <button id="loc-button">Get User Location</button>
        <div id="output"></div>
    </div>

    <script>
        "use strict";
            // declare pos here
        var pos;
        // From Google Maps JavaScript API
        // https://developers.google.com/maps/documentation/javascript/examples/map-geolocation
        $('#loc-button').click(function(){
            if(navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position){
                pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
                // https://stackoverflow.com/questions/14908864/how-can-i-use-data-posted-from-ajax-in-flask
                $.ajax({
                    type : "POST",
                    url : "{{url_for('index')}}",
                    data: JSON.stringify(pos),
                    contentType: 'application/json;charset=UTF-8',
                    success: function(result) {
                        console.log(result);
                        }});
                        console.log(pos);
                    });}
            else {
                console.log("geolocation is not supported");
            }})
    </script> -->